<!DOCTYPE html>
<!-- saved from url=(0052)http://getbootstrap.com/docs/4.0/examples/dashboard/ -->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Dashboard Template for Bootstrap</title>
    <!-- Bootstrap core CSS -->
    <link href="asserts/css/bootstrap.min.css" th:href="@{/asserts/css/bootstrap.min.css}" rel="stylesheet">
    <link href="asserts/css/style.css" th:href="@{/asserts/css/style.css}"  rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="asserts/css/dashboard.css" th:href="@{/asserts/css/dashboard.css}" rel="stylesheet">
    <style type="text/css">
        /* Chart.js */

        @-webkit-keyframes chartjs-render-animation {
            from {
                opacity: 0.99
            }
            to {
                opacity: 1
            }
        }

        @keyframes chartjs-render-animation {
            from {
                opacity: 0.99
            }
            to {
                opacity: 1
            }
        }

        .chartjs-render-monitor {
            -webkit-animation: chartjs-render-animation 0.001s;
            animation: chartjs-render-animation 0.001s;
        }
    </style>
</head>

<body>
<div th:replace="commons/sellerbar::topbar"></div>

<div class="container-fluid">
    <div class="row">
        <div th:replace="commons/sellerbar::#sidebar(activeUri=${goods==null?'/add':'/info/sellerdetail.html'})"></div>

        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 pt-3 px-4">
            <div class="g-doc">
                <div class="m-tab m-tab-fw m-tab-simple f-cb">
                    <h2>内容编辑</h2>
                </div>
                <div class="n-public">
                    <form class="m-form m-form-ht" id="form" method="post"  action=""  autocomplete="off"  >
                        <input type="hidden" name="_method" value="put" th:if="${goods!=null}">
                        <input type="hidden" name="id"  id="goodsid" th:value="${goods.id}" th:if="${goods!=null}">
                        <div class="fmitem">
                            <label class="fmlab">标题：</label>
                            <div class="fmipt">
                                <input type="hidden" name="id" value="1"/>
                                <input class="u-ipt ipt" name="goodsname" id="goodsname" value="" th:value="${goods!=null}?${goods.goodsname}" placeholder="2-80字符"/>
                            </div>
                        </div>
                        <div class="fmitem">
                            <label class="fmlab">摘要：</label>
                            <div class="fmipt">
                                <input class="u-ipt ipt" name="summary" id="summary" value="" th:value="${goods!=null}?${goods.summary}" placeholder="2-140字符"／>
                            </div>
                        </div>
                        <div class="fmitem">
                            <label class="fmlab">图片：</label>
                            <div class="fmipt" id="uploadType">
                                <input name="pic" type="radio" value="url"   class="radioItem"/> 图片地址
                                <input name="pic" type="radio" value="file" class="radioItem" checked/> 本地上传
                            </div>
                        </div>
                        <div class="fmitem">
                            <label class="fmlab"></label>
                            <div class="fmipt" id="urlUpload" style="display:none">
                                <input class="u-ipt ipt"  name="location" id="location" placeholder="图片地址"/>
                            </div>
                            <div class="fmipt" id="fileUpload"  >
                                <input class="u-ipt ipt" name="file" type="file" id="fileUp"/>
                                <button class="u-btn u-btn-primary" id="upload" type="button">上传</button>
                            </div>
                        </div>
                        <div class="fmitem">
                            <label class="fmlab">正文：</label>
                            <div class="fmipt">
                                <textarea class="u-ipt" name="info" rows="10" id="goodsinfo" th:text="${goods!=null}?${goods.info}" placeholder="2-1000个字符">好书</textarea>
                            </div>
                        </div>
                        <div class="fmitem">
                            <label class="fmlab">价格：</label>
                            <div class="fmipt">
                                <input class="u-ipt price" name="price" id="goodsprice" value="" th:value="${goods!=null}?${goods.price}"/>元
                            </div>
                        </div>
                        <div class="fmitem fmitem-nolab fmitem-btn">
                            <div class="fmipt">
                                <button type="button" class="u-btn u-btn-primary u-btn-lg" id="savebtn" th:text="${goods!=null? '保存' : '发布'}" >保 存</button>
                            </div>
                        </div>
                    </form>
                    <span class="imgpre"><img src="" th:src="${loc}" alt="" id="imgpre"></span>
                </div>
            </div>
        </main>
    </div>
</div>


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script type="text/javascript"  th:src="@{/asserts/js/jquery-1.11.0.min.js}" ></script>
<!--<script type="text/javascript"  th:src="@{/asserts/js/global.js}" ></script>-->
<!--<script type="text/javascript"  th:src="@{/asserts/js/pageShow.js}" ></script>-->
<script type="text/javascript"  th:src="@{/asserts/js/popper.min.js}" ></script>
<script type="text/javascript"  th:src="@{/asserts/js/bootstrap.min.js}" ></script>

<!-- Icons -->
<script type="text/javascript" th:src="@{/asserts/js/feather.min.js}" ></script>
<script>
    feather.replace()
</script>

<!-- Graphs -->
<script type="text/javascript" th:src="@{/asserts/js/Chart.min.js}"  ></script>

<script type="text/javascript">
    $(".radioItem").change(
        function() {
            var value = $("input[name='pic']:checked").val();
            if (value == "file") {
                $("#urlUpload").hide();
                $("#fileUpload").show();
            } else {
                $("#urlUpload").show();
                $("#fileUpload").hide();
            }
        });

    $("#upload").click(function () {
        var file = $("#fileUp").get(0).files[0];
        var formData = new FormData();
        formData.append("file",file);
        $.ajax({
            url:'/NTES/edit',
            type:'POST',
            data:formData,
            datatype:'JSON',
            processData:false,
            contentType: false,
            success:function(data){
                alert(data.imgpath)
                   $("#imgpre").attr("src",data.imgpath);
            }
        });
    })

    $("#savebtn").click(function () {
        var value = $("input[name='pic']:checked").val();
        var location;
        if (value == "file") {
            location = $("#imgpre")[0].src;
        }else {
            location = $("#location").val();
        }


        var text = $("#savebtn").text();
        if(text == '保存'){
            var id = $("#goodsid").val();;
            var goodsname = $("#goodsname").val();
            var summary = $("#summary").val();
            var info = $("#goodsinfo").val();
            var price = $("#price").val();
            $.ajax({
                url:'/NTES/edit',
                type:'POST',
                data:{
                    id:$("#goodsid").val(),
                    location:location,
                    goodsname: $("#goodsname").val(),
                    summary: $("#summary").val(),
                    info: $("#goodsinfo").val(),
                    price: $("#goodsprice").val(),
                    _method:"PUT",
                },
                success:function(data){
                    // window.location.href="/NTES/info/edSuccess.html";
                    localStorage.setItem("id",id);
                    var url = "/NTES/success";
                    $("#form").attr("action",url).submit();
                }
            })
        }else {
            var goodsname = $("#goodsname").val();
            var summary = $("#summary").val();
            var info = $("#goodsinfo").val();
            var price = $("#price").val();
            $.ajax({
                url:'/NTES/add',
                type:'POST',
                data:{
                    location:location,
                    goodsname: $("#goodsname").val(),
                    summary: $("#summary").val(),
                    info: $("#goodsinfo").val(),
                    price: $("#goodsprice").val(),
                },
                success:function(data){
                    // window.location.href="/NTES/info/edSuccess.html";
                    localStorage.setItem("id",id);
                    var url = "/NTES/success";
                    $("#form").attr("action",url).submit();
                }
            })

            $("#form").attr("action","/NTES/add").submit();
        }




    })


</script>

</body>

</html>